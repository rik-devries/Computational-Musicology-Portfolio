---
title: "Portfolio"
author: "Rik de Vries"
date: "2/19/2022"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(spotifyr)
library(tidyverse)
library(plotly)
library(flexdashboard)
library(compmus)
all_lp_tracks <- get_playlist_audio_features("", "1y9QYGfYFzSO7EF53wwLiB")
```
### Linkin Park's albums over time as the corpus selection
For my corpus, I was thinking of selecting different albums from Linkin Park on Spotify. I feel like this would make a very interesting corpus as the band has made a lot of very large changes over the years. Their early albums were very raw, producing a lot of music in the nu metal genre. The type of music they put out later on was much softer, which is something critics and some types of fans did not always like. I would like to identify the differences between these early and late albums.

If possible, I'd also like to compare the band's music to some of the band's side projects as well, like Chester Bennington's Grey Daze and Dead By Sunrise bands and Mike Shinoda's Fort Minor songs along with his new solo career that he started after Chester committed suicide.

A special album that I am very interested in is the Reanimation album. This is one of the top 5 best-selling remix albums, even to this day. Of course, as this only contains remixes, there should be a lot of visible differences to the rest of the band's work.

I feel like comparing all these songs would give a decent picture of how the band and its members changed over time. There are some limitations to this corpus, as the band used to have a different lead singer, Mark Wakefield, but they never released an official album back then. Next to that, the group has released many "Underground" albums, which are not on Spotify. These would have been very interesting to include in the corpus as well, to see if there are visible differences between the officially released albums and the albums that did not receive the same type of polishing.

### Album popularity dips but picks up to original heights
```{r pop_plot2, fig.height = 6, fig.width = 10, fig.align = "center", echo=FALSE}
# Filter out songs that have been duplicated
# (republished under the 20th anniversary album), along with inbetween-tracks
# that are shorter than a minute as these are not songs.
unq_lp_tracks = distinct(all_lp_tracks, track.name, .keep_all = TRUE) %>% 
  filter(track.duration_ms > 60000, track.album.album_type == "album")

unq_lp_tracks$year_album_published = 
  as.Date(format(as.Date(unq_lp_tracks$track.album.release_date, 
                         format="%Y-%m-%d"),"%Y"), "%Y")

main_albums <- c("Hybrid Theory (Bonus Edition)","Meteora (Bonus Edition)", "Minutes to Midnight",  "A Thousand Suns", "LIVING THINGS","The Hunting Party", "One More Light")
main_album_tracks <- unq_lp_tracks %>% filter(track.album.name %in% main_albums)
main_albums_plot <- ggplot(main_album_tracks, aes(x=year_album_published, y=track.popularity)) +
  labs(title="Linkin Park track popularity over time", x="Year", y="Popularity", color = "Album") +
  lims(y=c(0, 100)) +
  geom_point(aes(color=track.album.name, text=sprintf("Track: %s<br>Album: %s<br>Popularity: %s", track.name, track.album.name, track.popularity))) + 
  geom_smooth(aes(text=""))
#"Year: %s<br>Popularity: %s", year_album_published, track.popularity
w <- ggplotly(main_albums_plot, tooltip=c("text"))

# Disable hover for geom_smooth (trace 9) (Lower trace indices are for albums)
w %>%
  style(hoverinfo = "none", traces = 9)
```

***
The following plot shows the popularity of tracks from the main albums of the band Linkin Park. 
Data points on the chart can be hovered to get specific information (track name, the album it belongs to and its popularity).

To give a clear image of the band's popularity, the plot only relies on tracks from main albums. It therefore excludes remix albums and albums made after Chester Bennington's death.
The plot shows a trend that starts off downward sloping, with an all-time low in 2010. After this lowpoint though, it climbs back up to early 2000-levels. 

### Tracks get more well-defined pitch classes over time 
```{r echo=FALSE}
one_more_light <-
  get_tidy_audio_analysis("3xXBsjrbG1xQIm1xv1cKOt") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)
in_the_end <-
  get_tidy_audio_analysis("60a0Rd6pjrkxjPbaKzXjfq") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)
```

```{r fig.height = 6, fig.width = 10, fig.align = "center", echo=FALSE}
plot_oml <- one_more_light %>%
  mutate(pitches = map(pitches, compmus_normalise, "chebyshev")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()
plot_ite <- in_the_end %>%
  mutate(pitches = map(pitches, compmus_normalise, "chebyshev")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
      )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()

w <- subplot(plot_ite, plot_oml)

text_1 <-  paste0("Text geom_point:", "<br />", "X1=", w$x$data[[1]]$x, "<br />", "X2=", w$x$data[[1]]$y)
text_2 <-  paste0("Text geom_smooth:", "<br />" , w$x$data[[2]]$text)
w %>% 
    style(text="abcs") 

#w %>%
#  
#  #style(hoverinfo = "none") %>%
#  layout(annotations = list(
# list(x = 0.17 , y = 1.065, text = "In the End", showarrow = F, xref='paper', yref='paper'),
#  list(x = 0.87 , y = 1.065, text = "One More Light", showarrow = F, xref='paper', yref='paper'))
#)

```
***
This plot shows the chromagrams from two of Linkin Park's most popular songs, one from their first album and one from their last album. The song on the left is *In the End*, and the song on the right is *One More Light*. 

The first song changes a lot over the course of its duration. It has many instruments: piano, guitar, drums, electric instruments and there seems to be some electric crackling noises added too. On top of all of that, it has both Chester Bennington singing loudly, mixed with Mike Shinoda rapping. This leads to a very mixed chromagram where, even though the main notes are clearly visible, there is a lot of spread to other notes. 

One More Light takes a very different approach. It has very well-defined chroma's with barely any spread to other pitch classes. From the chromagram it can be seen that Chester sings on-key very well. The song is much more emotional, and less rock-like than *In the End*. It does not nearly contain as many instruments, or as much diversity. This displays a large difference between the two songs and their respective albums.

<!---
Comparisons with reviewers, 
Style of albums (loudness, dancability, ...)
-->